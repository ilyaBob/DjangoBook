let getNavigation=function(e){let t,i="none";if("object"==typeof e){let l=document.createNodeIterator(e,NodeFilter.SHOW_COMMENT);for(;t=l.nextNode();)if(8===t.nodeType&&"ENGINE_NAVIGATION"===t.nodeValue&&"ENGINE_NAVIGATION"!==t.nextSibling.nodeValue){i=t.nextSibling;break}}return i},navigation=getNavigation(document.body),filterNavigation="none";$(function(){$("[data-dlefilter*=dle-filter] input, [data-dlefilter*=dle-filter] textarea").keypress(function(e){13==e.which&&(e.preventDefault(),l($(this).closest("form"),!0))});let e=function(e){dleFilter.id=("FORM"!==e?$(e).closest("form[data-dlefilter]").data("dlefilter-id"):$(e).data("dlefilter-id"))||"dle-content",dleFilter.original[dleFilter.id]||"dle-content"==dleFilter.id||(dleFilter.original[dleFilter.id]=$("#"+dleFilter.id).html())},t=function(){dleFilter.reset=!0;let t=$(this).closest("form"),i=$(t).data("dlefilter");e(this),0==dleFilter.ajaxUrl&&(document.title=dleFilter.title,history.pushState(null,dleFilter.title,dleFilter.path)),"none"!==filterNavigation&&"dle-content"==dleFilter.id&&1==dleFilter.navApart&&$(getNavigation(document.body)).replaceWith(navigation),dleFilter.path.indexOf("/"+dleFilter.filterUrl+"/")+1?$("#dle-content").html(dleFilter.content):"dle-content"==dleFilter.id?$("#dle-content").html(dleFilter.content):$("#"+dleFilter.id).html(dleFilter.original[dleFilter.id]),1==dleFilter.lazy&&jQuery().lazyLoadXT&&$("[data-src]").lazyLoadXT(),$("#dle-speedbar").length>0&&$("#dle-speedbar").html(dleFilter.speedbar),$(t).find('input[type="text"]').each(function(){let e=$(this).prop("name");if(e.length>0){if(e.indexOf("r.")+1){let t=$(this).data("ionRangeSlider");"single"==t.options.type?t.update({from:t.options.min}):"double"==t.options.type&&t.update({from:t.options.min,to:t.options.max})}else $(this).val("");void 0!==$(this).data("dlefilter-show")&&f(this)}}),$(t).find("select").each(function(e){$(this).prop("name").length>0&&($(this).children("option").each(function(){$(this).prop("selected",!1)}),1==dleFilter.jsSelect&&$(".tail-select").length>0&&tail.select('[data-dlefilter*="'+i+'"] select[data-select-id="'+e+'"]').reload(),void 0!==$(this).data("dlefilter-show")&&f(this))}),2==dleFilter.jsSelect&&$(".chosen-results").length>0&&$('[data-dlefilter*="'+i+'"] select').trigger("chosen:updated"),3==dleFilter.jsSelect&&$('[data-dlefilter*="'+i+'"] select').niceSelect("update"),$(t).find('input[type="radio"], input[type="checkbox"]').each(function(){$(this).prop("name").length>0&&($(this).prop("checked",!1),void 0!==$(this).data("dlefilter-show")&&f(this))}),dleFilter.reset=!1},i=function(e){if("redirect"==(e=$.parseJSON(e)).content&&(dleFilter.ajax=1),1==dleFilter.ajax)window.location.href=e.url;else if(e.clean==dleFilter.defaultUrl)t();else{$("#dle-speedbar").length>0&&$("#dle-speedbar").html($("#dle-speedbar",e.speedbar).html());let i="";if(dleFilter.path.indexOf("/"+dleFilter.filterUrl+"/")+1?($("#dle-content").html(e.content),i="#dle-content"):($("#"+dleFilter.id).html(e.content),i="#"+dleFilter.id),e.player&&($(i+" .dleplyrplayer").length||$(i+" .dleplyrplayer").length||$(i+" .dlevideoplayer").length)){if("plyr"==e.player){let l=Array.from(document.querySelectorAll(".dleplyrplayer:not(.dlepl)")).map(e=>new DLEPlayer(e));l.forEach(function(e,t){e.on("play",function(){l.forEach(function(t,i){e!=t&&t.pause()})})})}else $(".dleaudioplayer:not(.alreadyLoaded)").addClass("alreadyLoaded").cleanaudioplayer(),$(".dlevideoplayer:not(.alreadyLoaded)").addClass("alreadyLoaded").cleanvideoplayer()}1===dleFilterId?($("pre").removeAttr("class"),$("pre").each(function(){$(this).find("code").length||$(this).wrapInner("<code>")}),hljs.highlightAll()):0===dleFilterId&&$("pre code:not([class])").each(function(e,t){hljs.highlightBlock(t,null)}),"none"!==navigation&&e.nav&&"dle-content"==dleFilter.id&&1==dleFilter.navApart?(filterNavigation=e.nav,navigation=getNavigation(document.body),$(navigation).replaceWith(e.nav)):e.nav||1!=dleFilter.navApart||(navigation=getNavigation(document.body)).remove(),1==dleFilter.lazy&&jQuery().lazyLoadXT&&$("[data-src]").lazyLoadXT(),0==dleFilter.ajaxUrl&&(history.pushState(null,e.title,e.clean),document.title=e.title)}},l=function(t,l){if(dleFilter.reset)return;$('[data-dlefilter*=dle-filter] input[name*="r."]').each(function(){let e=$(this).attr("name");if(void 0!==e&&e.length>0){let t=$(this).data("ionRangeSlider"),i=0;"single"==t.options.type?i=t.options.min:"double"==t.options.type&&(i=t.options.min+";"+t.options.max),i==$(this).val()&&$(this).val("")}});let a,n,d="";if(!0===(l=l||!1))a=$(t).serialize();else{if(n=t.target.tagName.toUpperCase(),void 0!==t.target.type&&(d=t.target.type.toUpperCase()),"TEXTAREA"===n||"INPUT"===n&&("TEXT"===d||"RESET"===d))return;a="FORM"!==n?$(this).closest("form").serialize():$(this).serialize()}e(n),$.ajax({beforeSend:function(){0==dleFilter.hideLoading&&ShowLoading("")},url:dle_root+"engine/lazydev/dle_filter/ajax.php",type:"POST",data:{data:a,url:dleFilter.path,dle_hash:dle_login_hash,dleFilterJSData},success:function(e){e.error?DLEalert(e.text,dle_info):i(e)},error:function(e){i(e.responseText)}}).always(function(){0==dleFilter.hideLoading&&HideLoading("")})};$("#dle-speedbar").length>0&&(dleFilter.speedbar=$("#dle-speedbar").html()),$("#dle-content").length>0&&(dleFilter.content=$("#dle-content").html()),$("body").on("click","[data-dlefilter=submit]",l),0==dleFilter.button&&$("body").on("change","[data-dlefilter*=dle-filter]",l),$("body").on("click","[data-dlefilter=reset]",t);let a=function(e){return e.valueOf()},n=function(e){return!!Array.isArray(e=e.toString().split(","))&&3===e.length&&(e[0]=parseInt(e[0]),e[1]=parseInt(e[1]),e[2]=parseInt(e[2]),e[0]>0&&e[1]>0&&e[1]<=12&&e[2]>0&&e[2]<=31)&&e};function d(e,t,i){return(e-t)/(i-t)*100}$("[data-dlefilter*=dle-filter]").find('input[type="text"][name*="r."]').each(function(){let e=$(this).data("slider-config"),t=$(this).data("slider-type"),i=$(this).data("slider-lang"),r=$(this).data("slider-mark"),o="";if(void 0!==e&&e.length>0){let s={};";"===e.slice(-1)&&(e=e.slice(0,-1)),e=e.split(";");for(let c=0;c<e.length;c++){let f=e[c].split(":");switch(f[0]=f[0].trim(),f[0]){case"АвтоПолзунок":case"AutoSlider":s.slider=!0;break;case"Одиночный слайдер":case"Single":s.type="single";break;case"Двойной слайдер":case"Double":s.type="double";break;case"Минимальное значение":case"Min":void 0!==f[1]&&($.isNumeric(f[1])?s.min=f[1]:"date"===t&&!1!==(o=n(f[1]))&&(s.min=a(new Date(o[0],o[1]-1,o[2]))));break;case"Максимальное значение":case"Max":void 0!==f[1]&&($.isNumeric(f[1])?s.max=f[1]:"date"===t&&!1!==(o=n(f[1]))&&(s.max=a(new Date(o[0],o[1]-1,o[2]))));break;case"Начало слайдера":case"Start":void 0!==f[1]&&($.isNumeric(f[1])?s.from=f[1]:"date"===t&&!1!==(o=n(f[1]))&&(s.from=a(new Date(o[0],o[1]-1,o[2]))));break;case"Конец слайдера":case"End":void 0!==f[1]&&($.isNumeric(f[1])?s.to=f[1]:"date"===t&&!1!==(o=n(f[1]))&&(s.to=a(new Date(o[0],o[1]-1,o[2]))));break;case"Шаг":case"Step":void 0!==f[1]&&$.isNumeric(f[1])&&(s.step=f[1]);break;case"Шаблон":case"Tpl":void 0!==f[1]&&""!==f[1]&&(s.skin=f[1]);break;case"Префикс":case"Prefix":void 0!==f[1]&&""!==f[1]&&(s.prefix=f[1]);break;case"Постфикс":case"Postfix":void 0!==f[1]&&""!==f[1]&&(s.postfix=f[1]);break;case"Сетка":case"Grid":s.grid=!0;break;case"Красивые числа":case"Numbers":s.prettify_enabled=!0;break;case"Скрыть MinMax":case"Hide MinMax":s.hide_min_max=!0;break;case"Скрыть FromTo":case"Hide FromTo":s.hide_from_to=!0}}if(void 0===s.from&&(s.from=s.min),void 0===s.to&&(s.to=s.max),r){let h=r.toString().split(",");s.onStart=function(e){!function e(t,i,l){let a="",n=0,r="";for(let o=0;o<l.length;o++){let s=l[o].toString().split("|");a+='<span class="sliderShowcaseMark" style="left: '+(r=(n=d(parseInt(s[0]),i.min,i.max))+"%")+'">'+s[1]+"</span>"}t.append(a)}(e.slider,s,h)}}"date"===t&&(s.prettify=function(e){return new Date(e).toLocaleDateString(i,{year:"numeric",month:"long",day:"numeric"})}),s.prettify_enabled||"date"===t||(s.prettify_enabled=!1),s.slider&&(s.onFinish=function(e){l($('[name="'+e.input[0].name+'"]').closest("form"),!0)}),$(this).ionRangeSlider(s)}}),1==dleFilter.jsSelect&&$("[data-dlefilter*=dle-filter]").find("select").each(function(e){$(this).attr("data-select-id",e);let t=$(this).data("select-config"),i={};if(void 0!==t&&t.length>0){";"==t.slice(-1)&&(t=t.slice(0,-1)),t=t.split(";");for(let l=0;l<t.length;l++){let a=t[l].split(":");switch(a[0]){case"Поиск":case"Search":i.search=!0;break;case"Скрыть выбранные":case"Hide":i.hideSelected=!0;break;case"Максимум выбрать":case"Max":void 0!==a[1]&&$.isNumeric(a[1])&&(i.multiLimit=a[1]);break;case"Показать количество выбранных":case"Num":i.multiContainer||(i.multiShowCount=!0);break;case"Вывод выбранных":case"Show":i.multiContainer=!0,i.multiShowCount&&(i.multiShowCount=!1);break;case"Подсказка":case"Prompt":void 0!==a[1]&&""!==a[1]&&(i.placeholder=a[1]);break;case"Язык":case"Lang":(void 0===a[1]||""==a[1].trim())&&(a[1]="ru"),i.locale=a[1];break;case"Сортировать":case"Sort":void 0!==a[1]&&("ASC"===a[1]||"DESC"===a[1])&&(i.sortItems=a[1])}}}void 0==i.locale&&(i.locale="ru"),i.deselect=!0,tail.select('[data-dlefilter*=dle-filter] select[data-select-id="'+e+'"]',i).on("change",function(e,t){let i="OPTGROUP"===e.option.parentElement.tagName.toUpperCase()?e.option.parentElement.parentElement.name:e.option.parentElement.name;"unselect"===t&&$('[name="'+i+'"]').val(""),0==dleFilter.button&&$('[name="'+i+'"]').trigger("change")})}),2==dleFilter.jsSelect&&$("[data-dlefilter*=dle-filter] select").chosen(),3==dleFilter.jsSelect&&$("[data-dlefilter*=dle-filter] select").niceSelect();let r=function(e,t){void 0!==e&&$.ajax({url:e,beforeSend:function(){0==dleFilter.hideLoading&&ShowLoading("")},success:function(i){if($("#dle-speedbar").length>0&&$("#dle-speedbar").html($("#dle-speedbar",i).html()),"none"!==navigation&&1==dleFilter.navApart){let l=new DOMParser().parseFromString(i,"text/html"),a=getNavigation(l),n=getNavigation(document.body);filterNavigation=a,$(n).replaceWith(a)}if(window.location.href.toString().indexOf(t)+1?$("#dle-content").html($("#dle-content",i).html()):$("#"+dleFilter.id).html($("#dle-content",i).html()),1==dleFilter.lazy&&jQuery().lazyLoadXT&&$("[data-src]").lazyLoadXT(),0==dleFilter.ajaxUrl){let d=$(i).filter("title").text();window.history.pushState(d,"",e),""!=d&&(document.title=$(i).filter("title").text())}0==dleFilter.ajaxAnim&&$("html, body").animate({scrollTop:$("#"+dleFilter.id).offset().top},400)},error:function(e){1===dle_group&&console.log(e.responseText,dle_info)}}).always(function(){0==dleFilter.hideLoading&&HideLoading("")})};1==dleFilter.ajaxPage&&0!=urlFilter&&$("body").on("click",'a[href*="'+urlFilter+'"]',function(e){e.preventDefault(),dleFilter.id="dle-content";let t=$(this).attr("href");return r(t,urlFilter),!1}),1==dleFilter.ajaxNav&&$("body").on("click",'a[href*="/'+dleFilter.filterUrl+'/"]',function(t){t.preventDefault(),e(this);let i=$(this).attr("href");return r(i,"/"+dleFilter.filterUrl+"/"),!1}),Array.prototype.diff=function(e){return this.filter(function(t){return 0>e.indexOf(t)})};let o={},s={},c={},f=function(e){let t=$(e).prop("tagName").toUpperCase(),i=$(e).prop("type").toUpperCase(),l=$(e).data("dlefilter-show"),a={};";"==l.slice(-1)&&(l=l.slice(0,-1)),l=l.split(";"),$.each(l,function(e,t){let i=t.split(":");i[0]&&i[1]&&(a[i[0]]=i[1].split(","))}),"SELECT"===t?$(e).find("option").each(function(e,t){$.each(a,function(e,i){$(t).val().toString().length>0&&$(t).prop("selected")&&$.inArray($(t).val(),i)>=0?1==dleFilter.jsSelect?o[e]=".dle-filter-select-"+e:o[e]='[data-dlefilter-hide="'+e+'"]':1==dleFilter.jsSelect?s[e]=".dle-filter-select-"+e:s[e]='[data-dlefilter-hide="'+e+'"]'})}):"INPUT"===t?$.each(a,function(t,l){"TEXT"===i?$.inArray($(e).val(),l)>=0?o[t]='[data-dlefilter-hide="'+t+'"]':s[t]='[data-dlefilter-hide="'+t+'"]':("RADIO"===i||"CHECKBOX"===i)&&($(e).prop("checked")&&$.inArray($(e).val(),l)>=0?o[t]='[data-dlefilter-hide="'+t+'"]':s[t]='[data-dlefilter-hide="'+t+'"]')}):"TEXTAREA"===t&&$.each(a,function(t,i){$.inArray($(e).val(),i)>=0?o[t]='[data-dlefilter-hide="'+t+'"]':s[t]='[data-dlefilter-hide="'+t+'"]'});let n=Object.values(s),d=Object.values(o);(c=n.filter(e=>!d.includes(e)))&&$.each(c,function(e,t){$(t).find('input[type="text"]').each(function(){let e=$(this).prop("name");if(void 0!==$(this).data("dlefilter-show")&&f(this),e.length>0){if(e.indexOf("r.")+1){let t=$(this).data("ionRangeSlider");t.update({from:t.options.min,to:t.options.max})}else $(this).val("")}}),$(t).find("select").each(function(e){$(this).prop("name").length>0&&(void 0!==$(this).data("dlefilter-show")&&f(this),$(this).children("option").each(function(){$(this).attr("selected",!1)}),1==dleFilter.jsSelect)&&$(".tail-select").length>0&&tail.select('[data-dlefilter*=dle-filter] select[data-select-id="'+e+'"]').reload()}),2==dleFilter.jsSelect&&$(".chosen-results").length>0&&$("[data-dlefilter*=dle-filter] select").trigger("chosen:updated"),3==dleFilter.jsSelect&&$("[data-dlefilter*=dle-filter] select").niceSelect("update"),$(t).find('input[type="radio"], input[type="checkbox"]').each(function(){$(this).prop("name").length>0&&(void 0!==$(this).data("dlefilter-show")&&f(this),$(this).attr("checked",!1))})})};dleFilter.path.indexOf("/"+dleFilter.filterUrl+"/")+1&&function(){let e=decodeURIComponent(location.href).split("/"+dleFilter.filterUrl+"/");if(!e[1])return;"/"===e[1].slice(-1)&&(e[1]=e[1].slice(0,-1)),e=e[1].split("/");let t=[];for(let i=0;i<e.length;i++)t[i]=e[i].split("="),t[i][1]&&(t[i][0]=t[i][0].replace(/\+/g," "),t[i][1]=t[i][1].replace(/\+/g," "));$('[data-dlefilter*=dle-filter] input[type="text"], [data-dlefilter*=dle-filter] textarea').each(function(){let e=$(this).attr("name");if(void 0!==e&&e.length>0){for(let i=0;i<t.length;i++)if(e===t[i][0]){if(e.indexOf("r.")+1){let l=$(this).data("ionRangeSlider"),a=t[i][1].split(";");"single"==l.options.type?l.update({from:a[0]}):"double"==l.options.type&&l.update({from:a[0],to:a[1]})}else $(this).val(t[i][1])}}}),$("[data-dlefilter*=dle-filter] select").each(function(e){let i=$(this).attr("name");if(void 0!==i&&i.length>0){for(let l=0;l<t.length;l++)if(i===t[l][0]){let a=[];i.indexOf("c.")+1?a[0]=t[l][1]:a=t[l][1].split(","),$(this).find("option").each(function(e,t){$.inArray(t.value,a)>=0&&$(this).attr("selected",!0)})}1==dleFilter.jsSelect&&$(".tail-select").length>0&&tail.select('[data-dlefilter*=dle-filter] select[data-select-id="'+e+'"]').reload()}}),2==dleFilter.jsSelect&&$(".chosen-results").length>0&&$("[data-dlefilter*=dle-filter] select").trigger("chosen:updated"),3==dleFilter.jsSelect&&$("[data-dlefilter*=dle-filter] select").niceSelect("update"),$('[data-dlefilter*=dle-filter] input[type="radio"], [data-dlefilter*=dle-filter] input[type="checkbox"]').each(function(){let e=$(this).attr("name");if(void 0!==e&&e.length>0){for(let i=0;i<t.length;i++)if(e===t[i][0]){let l=t[i][1].split(",");$(this).each(function(e,t){$.inArray(t.value,l)>=0&&$(this).attr("checked","checked")})}}})}(),$("[data-dlefilter-hide]").hide(),$("body").find("[data-dlefilter-show]").each(function(e,t){s={},c={},o={},f(t),c&&$(c.join(", ")).hide(),o&&$(Object.values(o).join(", ")).show()}),$("body").on("change","[data-dlefilter-show]",function(e){s={},c={},o={},$("body").find("[data-dlefilter-show]").each(function(e,t){f(t)}),c&&$(c.join(", ")).hide(),o&&$(Object.values(o).join(", ")).show()})});